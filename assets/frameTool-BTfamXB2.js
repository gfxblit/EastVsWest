import"./modulepreload-polyfill-B5Qt9EMX.js";class c{calculateFrames(t){const i=parseInt(t.startX,10),e=parseInt(t.startY,10),s=parseInt(t.frameWidth,10),n=parseInt(t.frameHeight,10),a=parseInt(t.frameCount,10),h=[];for(let r=0;r<a;r++)h.push({x:i+r*s,y:e,w:s,h:n,anchor:{x:s/2,y:n/2}});return h}}class m{constructor(){this.calculator=new c,this.image=null,this.frames=[],this.currentFrameIndex=0,this.lastFrameTime=0,this.animationId=null,this.imageInput=document.getElementById("imageInput"),this.inputs={startX:document.getElementById("startX"),startY:document.getElementById("startY"),frameWidth:document.getElementById("frameWidth"),frameHeight:document.getElementById("frameHeight"),frameCount:document.getElementById("frameCount"),fps:document.getElementById("fps"),globalWidth:document.getElementById("globalWidth"),globalHeight:document.getElementById("globalHeight")},this.exportBtn=document.getElementById("exportBtn"),this.mainCanvas=document.getElementById("mainCanvas"),this.previewCanvas=document.getElementById("previewCanvas"),this.jsonOutput=document.getElementById("jsonOutput"),this.dropZone=document.getElementById("dropZone"),this.overlayLayer=document.getElementById("overlayLayer"),this.ctx=this.mainCanvas.getContext("2d"),this.previewCtx=this.previewCanvas.getContext("2d"),this.anchorOverrides={},this.frameOverrides={},this.draggingFrame=null,this.dragStartMouse={x:0,y:0},this.dragStartAnchor={x:0,y:0},this.dragStartFramePos={x:0,y:0},this.init()}init(){this.imageInput.addEventListener("change",t=>this.handleFileSelect(t.target.files[0])),Object.values(this.inputs).forEach(t=>{t.addEventListener("input",()=>this.update())}),this.exportBtn.addEventListener("click",()=>this.exportSpriteSheet()),this.mainCanvas.addEventListener("mousedown",t=>this.handleCanvasClick(t)),window.addEventListener("mousemove",t=>this.handleGlobalMouseMove(t)),window.addEventListener("mouseup",()=>this.handleGlobalMouseUp()),this.dropZone.addEventListener("dragover",t=>{t.preventDefault(),this.dropZone.style.backgroundColor="#333"}),this.dropZone.addEventListener("dragleave",t=>{t.preventDefault(),this.dropZone.style.backgroundColor="#222"}),this.dropZone.addEventListener("drop",t=>{t.preventDefault(),this.dropZone.style.backgroundColor="#222",t.dataTransfer.files.length>0&&this.handleFileSelect(t.dataTransfer.files[0])}),this.animate(0)}handleFileSelect(t){if(!t||!t.type.startsWith("image/"))return;const i=new FileReader;i.onload=e=>{const s=new Image;s.onload=()=>{this.image=s,this.mainCanvas.width=s.width,this.mainCanvas.height=s.height,this.overlayLayer.style.width=s.width+"px",this.overlayLayer.style.height=s.height+"px",this.update()},s.src=e.target.result},i.readAsDataURL(t)}getConfig(){return{startX:parseInt(this.inputs.startX.value)||0,startY:parseInt(this.inputs.startY.value)||0,frameWidth:parseInt(this.inputs.frameWidth.value)||32,frameHeight:parseInt(this.inputs.frameHeight.value)||32,frameCount:parseInt(this.inputs.frameCount.value)||1,fps:parseInt(this.inputs.fps.value)||10,globalWidth:parseInt(this.inputs.globalWidth.value)||64,globalHeight:parseInt(this.inputs.globalHeight.value)||64}}update(){const t=this.getConfig();this.frames=this.calculator.calculateFrames(t),this.frames.forEach((i,e)=>{this.frameOverrides[e]&&(i.x=this.frameOverrides[e].x,i.y=this.frameOverrides[e].y),this.anchorOverrides[e]&&(i.anchor={...this.anchorOverrides[e]})}),this.renderMain(),this.renderOverlays(),this.updateJSON(t),this.previewCanvas.width=t.globalWidth,this.previewCanvas.height=t.globalHeight}handleCanvasClick(t){if(!this.image)return;const i=this.mainCanvas.getBoundingClientRect(),e=t.clientX-i.left,s=t.clientY-i.top,n=this.frames.findIndex(a=>e>=a.x&&e<a.x+a.w&&s>=a.y&&s<a.y+a.h);if(n!==-1){const a=this.frames[n];this.anchorOverrides[n]={x:e-a.x,y:s-a.y},this.update()}}handleHandleMouseDown(t,i){t.stopPropagation(),this.draggingFrame=i,this.dragStartMouse={x:t.clientX,y:t.clientY},this.dragStartAnchor={...this.frames[i].anchor},this.dragStartFramePos={x:this.frames[i].x,y:this.frames[i].y}}handleGlobalMouseMove(t){if(this.draggingFrame!==null){const i=t.clientX-this.dragStartMouse.x,e=t.clientY-this.dragStartMouse.y;t.shiftKey?this.anchorOverrides[this.draggingFrame]={x:this.dragStartAnchor.x+i,y:this.dragStartAnchor.y+e}:this.frameOverrides[this.draggingFrame]={x:this.dragStartFramePos.x+i,y:this.dragStartFramePos.y+e},this.update()}}handleGlobalMouseUp(){this.draggingFrame=null}renderOverlays(){this.overlayLayer.innerHTML="",this.frames.forEach((t,i)=>{const e=document.createElement("div");e.textContent=i,e.style.position="absolute",e.style.left=t.x+t.anchor.x+"px",e.style.top=t.y+t.anchor.y+"px",e.style.transform="translate(-50%, -50%)",e.style.width="20px",e.style.height="20px",e.style.backgroundColor="rgba(0, 255, 0, 0.7)",e.style.color="white",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.borderRadius="50%",e.style.fontSize="10px",e.style.cursor="move",e.style.pointerEvents="auto",e.style.userSelect="none",this.draggingFrame===i&&(e.style.backgroundColor="rgba(255, 255, 0, 0.9)",e.style.color="black",e.style.border="2px solid white",e.style.zIndex="100"),e.addEventListener("mousedown",s=>this.handleHandleMouseDown(s,i)),this.overlayLayer.appendChild(e)})}renderMain(){this.ctx.clearRect(0,0,this.mainCanvas.width,this.mainCanvas.height),this.image&&this.ctx.drawImage(this.image,0,0),this.ctx.lineWidth=1,this.frames.forEach((t,i)=>{this.ctx.strokeStyle="#00ff00",this.ctx.strokeRect(t.x,t.y,t.w,t.h);const e=t.x+t.anchor.x,s=t.y+t.anchor.y;this.ctx.strokeStyle="#ff0000",this.ctx.beginPath(),this.ctx.moveTo(e-10,s),this.ctx.lineTo(e+10,s),this.ctx.moveTo(e,s-10),this.ctx.lineTo(e,s+10),this.ctx.stroke()})}updateJSON(t){let i={frameWidth:t.frameWidth,frameHeight:t.frameHeight};if(this.image){i.columns=Math.floor(this.image.width/t.frameWidth),i.rows=Math.floor(this.image.height/t.frameHeight);const e=Math.floor(t.startY/t.frameHeight);i.animations={sample_animation:{row:e,frames:t.frameCount}}}else i.frames=this.frames;this.jsonOutput.value=JSON.stringify(i,null,2)}exportSpriteSheet(){if(!this.image||this.frames.length===0)return;const t=this.getConfig(),i=document.createElement("canvas");i.width=t.globalWidth*this.frames.length,i.height=t.globalHeight;const e=i.getContext("2d");this.frames.forEach((r,l)=>{const d=l*t.globalWidth+t.globalWidth/2-r.anchor.x,g=t.globalHeight/2-r.anchor.y;e.drawImage(this.image,r.x,r.y,r.w,r.h,d,g,r.w,r.h)});const s=document.createElement("a");s.download="aligned_spritesheet.png",s.href=i.toDataURL("image/png"),s.click();const n={frameWidth:t.globalWidth,frameHeight:t.globalHeight,columns:this.frames.length,rows:1,animations:{animation:{row:0,frames:this.frames.length}}},a=document.createElement("a");a.download="aligned_spritesheet.json";const h=new Blob([JSON.stringify(n,null,2)],{type:"application/json"});a.href=URL.createObjectURL(h),a.click()}animate(t){if(this.image&&this.frames.length>0){const e=1e3/this.getConfig().fps;t-this.lastFrameTime>e&&(this.currentFrameIndex=(this.currentFrameIndex+1)%this.frames.length,this.lastFrameTime=t,this.renderPreview())}requestAnimationFrame(i=>this.animate(i))}renderPreview(){const t=this.frames[this.currentFrameIndex];if(!t)return;const i=this.getConfig();this.previewCtx.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);const e=i.globalWidth/2-t.anchor.x,s=i.globalHeight/2-t.anchor.y;this.previewCtx.strokeStyle="rgba(255, 255, 255, 0.2)",this.previewCtx.beginPath(),this.previewCtx.moveTo(i.globalWidth/2,0),this.previewCtx.lineTo(i.globalWidth/2,i.globalHeight),this.previewCtx.moveTo(0,i.globalHeight/2),this.previewCtx.lineTo(i.globalWidth,i.globalHeight/2),this.previewCtx.stroke(),this.previewCtx.drawImage(this.image,t.x,t.y,t.w,t.h,e,s,t.w,t.h),this.previewCtx.fillStyle="rgba(0, 0, 0, 0.5)",this.previewCtx.fillRect(0,0,20,15),this.previewCtx.fillStyle="white",this.previewCtx.font="10px sans-serif",this.previewCtx.fillText(this.currentFrameIndex,2,11)}}new m;

import"./modulepreload-polyfill-B5Qt9EMX.js";class m{calculateFrames(t){const e=parseInt(t.startX,10),a=parseInt(t.startY,10),i=parseInt(t.frameWidth,10),h=parseInt(t.frameHeight,10),l=parseInt(t.frameCount,10),r=[];for(let s=0;s<l;s++)r.push({x:e+s*i,y:a,w:i,h});return r}}class d{constructor(){this.calculator=new m,this.image=null,this.frames=[],this.currentFrameIndex=0,this.lastFrameTime=0,this.animationId=null,this.imageInput=document.getElementById("imageInput"),this.inputs={startX:document.getElementById("startX"),startY:document.getElementById("startY"),frameWidth:document.getElementById("frameWidth"),frameHeight:document.getElementById("frameHeight"),frameCount:document.getElementById("frameCount"),fps:document.getElementById("fps")},this.mainCanvas=document.getElementById("mainCanvas"),this.previewCanvas=document.getElementById("previewCanvas"),this.jsonOutput=document.getElementById("jsonOutput"),this.dropZone=document.getElementById("dropZone"),this.ctx=this.mainCanvas.getContext("2d"),this.previewCtx=this.previewCanvas.getContext("2d"),this.init()}init(){this.imageInput.addEventListener("change",t=>this.handleFileSelect(t.target.files[0])),Object.values(this.inputs).forEach(t=>{t.addEventListener("input",()=>this.update())}),this.dropZone.addEventListener("dragover",t=>{t.preventDefault(),this.dropZone.style.backgroundColor="#333"}),this.dropZone.addEventListener("dragleave",t=>{t.preventDefault(),this.dropZone.style.backgroundColor="#222"}),this.dropZone.addEventListener("drop",t=>{t.preventDefault(),this.dropZone.style.backgroundColor="#222",t.dataTransfer.files.length>0&&this.handleFileSelect(t.dataTransfer.files[0])}),this.animate(0)}handleFileSelect(t){if(!t||!t.type.startsWith("image/"))return;const e=new FileReader;e.onload=a=>{const i=new Image;i.onload=()=>{this.image=i,this.mainCanvas.width=i.width,this.mainCanvas.height=i.height,this.update()},i.src=a.target.result},e.readAsDataURL(t)}getConfig(){return{startX:parseInt(this.inputs.startX.value)||0,startY:parseInt(this.inputs.startY.value)||0,frameWidth:parseInt(this.inputs.frameWidth.value)||32,frameHeight:parseInt(this.inputs.frameHeight.value)||32,frameCount:parseInt(this.inputs.frameCount.value)||1,fps:parseInt(this.inputs.fps.value)||10}}update(){const t=this.getConfig();this.frames=this.calculator.calculateFrames(t),this.renderMain(),this.updateJSON(t),this.previewCanvas.width=t.frameWidth,this.previewCanvas.height=t.frameHeight}renderMain(){this.ctx.clearRect(0,0,this.mainCanvas.width,this.mainCanvas.height),this.image&&this.ctx.drawImage(this.image,0,0),this.ctx.strokeStyle="#00ff00",this.ctx.lineWidth=1,this.frames.forEach((t,e)=>{this.ctx.strokeRect(t.x,t.y,t.w,t.h),this.ctx.fillStyle="rgba(0, 255, 0, 0.5)",this.ctx.fillRect(t.x,t.y,20,15),this.ctx.fillStyle="black",this.ctx.font="10px sans-serif",this.ctx.fillText(e,t.x+2,t.y+11)})}updateJSON(t){let e={frameWidth:t.frameWidth,frameHeight:t.frameHeight};if(this.image){e.columns=Math.floor(this.image.width/t.frameWidth),e.rows=Math.floor(this.image.height/t.frameHeight);const a=Math.floor(t.startY/t.frameHeight);e.animations={sample_animation:{row:a,frames:t.frameCount}}}else e.frames=this.frames;this.jsonOutput.value=JSON.stringify(e,null,2)}animate(t){if(this.image&&this.frames.length>0){const a=1e3/this.getConfig().fps;t-this.lastFrameTime>a&&(this.currentFrameIndex=(this.currentFrameIndex+1)%this.frames.length,this.lastFrameTime=t,this.renderPreview())}requestAnimationFrame(e=>this.animate(e))}renderPreview(){const t=this.frames[this.currentFrameIndex];t&&(this.previewCtx.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),this.previewCtx.drawImage(this.image,t.x,t.y,t.w,t.h,0,0,this.previewCanvas.width,this.previewCanvas.height),this.previewCtx.fillStyle="rgba(0, 0, 0, 0.5)",this.previewCtx.fillRect(0,0,20,15),this.previewCtx.fillStyle="white",this.previewCtx.font="10px sans-serif",this.previewCtx.fillText(this.currentFrameIndex,2,11))}}new d;
